scale_color_manual(values = c_drug) +
ggtitle('PCoA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PCo1 (", format(eig1, digits = 4), "%)"),
y = paste0("PCo2 (", format(eig2, digits = 4), "%)"))
dn_ds_mat2 <- readRDS("../03.results/20240409_Boston_dN_dS_mat_005.rds")
dn_ds_mat2 <- readRDS("../03.results/20240409_Boston_dN_dS_mat_005.rds")
dn_ds_dis <- as.matrix(parDist(as.matrix(dn_ds_mat2), method = "euclidean"))
dn_ds_dis[is.na(dn_ds_dis)] <- 0
dmr <- cmdscale(dn_ds_dis, k = 4, eig = T)
eig <- dmr$eig
eig[eig < 0] <- 0
eig1 <- 100 * eig[1] / sum(eig)
eig2 <- 100 * eig[2] / sum(eig)
points <- as.data.frame(dmr$points[, 1:2])
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
ggtitle('PCoA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PCo1 (", format(eig1, digits = 4), "%)"),
y = paste0("PCo2 (", format(eig2, digits = 4), "%)"))
ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(size = 2.4, shape = 1) + main_theme +
scale_color_manual(values = c_drug) +
ggtitle('PCoA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PCo1 (", format(eig1, digits = 4), "%)"),
y = paste0("PCo2 (", format(eig2, digits = 4), "%)"))
dn_ds_dis <- as.matrix(parDist(as.matrix(dn_ds_mat2), method = "cosine"))
dn_ds_mat2 <- readRDS("../03.results/20240409_Boston_dN_dS_mat_005.rds")
dn_ds_dis <- as.matrix(parDist(as.matrix(dn_ds_mat2), method = "cosine"))
dn_ds_dis[is.na(dn_ds_dis)] <- 0
dmr <- cmdscale(dn_ds_dis, k = 4, eig = T)
eig <- dmr$eig
eig[eig < 0] <- 0
eig1 <- 100 * eig[1] / sum(eig)
eig2 <- 100 * eig[2] / sum(eig)
points <- as.data.frame(dmr$points[, 1:2])
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(size = 2.4, shape = 1) + main_theme +
scale_color_manual(values = c_drug) +
ggtitle('PCoA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PCo1 (", format(eig1, digits = 4), "%)"),
y = paste0("PCo2 (", format(eig2, digits = 4), "%)"))
ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4, shape = 1) + main_theme +
scale_color_manual(values = c_drug) +
ggtitle('PCoA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PCo1 (", format(eig1, digits = 4), "%)"),
y = paste0("PCo2 (", format(eig2, digits = 4), "%)"))
head(points)
ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
ggtitle('PCoA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PCo1 (", format(eig1, digits = 4), "%)"),
y = paste0("PCo2 (", format(eig2, digits = 4), "%)"))
ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCoA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PCo1 (", format(eig1, digits = 4), "%)"),
y = paste0("PCo2 (", format(eig2, digits = 4), "%)"))
knitr::opts_chunk$set(echo = TRUE)
library(parallelDist) ## for distance calculation
library(ggpubr) ## for geom_pwc()
library(gggenes) ## for geom_gene_arrow()
library(pheatmap)
library(vegan)
source("settings.R")
c_drug <- c("N" = "gold4", "Unknown " = "skyblue", "Y" = "gold2")
c_drug_lst <- list(Antibiotics = c_drug)
pn_ps_mat2 <- pn_ps_mat[, colSums(pn_ps_mat != 0) > n]
################ For dN/dS plot ######################
pn_ps <- dat_plot[dat_plot$Evidence == "pN_pS",
colnames(dat_plot) %in% c("Sample_ID",
"Antibiotics",
"Gene_ID",
"Selection")]
pn_ps_mat <- as.data.frame(pn_ps %>% pivot_wider(names_from = "Gene_ID",
values_from = "Selection"))
des <- data.frame(Antibiotics = pn_ps_mat$Antibiotics)
rownames(des) <- pn_ps_mat$Sample_ID
des$Antibiotics <- as.character(des$Antibiotics)
rownames(pn_ps_mat) <- pn_ps_mat$Sample_ID
pn_ps_mat <- pn_ps_mat[, !(colnames(pn_ps_mat) %in%
c("Antibiotics", "Sample_ID"))]
pn_ps_mat <- log10(pn_ps_mat)
pn_ps_mat[is.na(pn_ps_mat)] <- 0
pheatmap(pn_ps_mat, show_rownames = FALSE, show_colnames = FALSE,
annotation_row = des, annotation_colors = c_drug_lst)
n
pn_ps_mat2 <- pn_ps_mat[, colSums(pn_ps_mat != 0) > n]
pn_ps_mat2 <- pn_ps_mat2[rowSums(pn_ps_mat2!=0) > n, ]
## save the matrix for GWAS (next Rmd), it is log10 transformed already
saveRDS(pn_ps_mat2, "../03.results/20240409_Boston_pN_pS_mat_005.rds")
pn_ps_mat2 <- readRDS("../03.results/20240409_Boston_pN_pS_mat_005.rds")
pn_ps_dis <- as.matrix(parDist(as.matrix(pn_ps_mat2), method = "cosine"))
pn_ps_dis[is.na(pn_ps_dis)] <- 0
dmr <- cmdscale(pn_ps_dis, k = 4, eig = T)
eig <- dmr$eig
eig[eig < 0] <- 0
points <- as.data.frame(dmr$points[, 1:2])
eig1 <- 100 * eig[1] / sum(eig)
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCoA of pN/pS in B. uniformis, Cosine distance') +
labs (x = paste0("PCo1 (", format(eig1, digits = 4), "%)"),
y = paste0("PCo2 (", format(eig2, digits = 4), "%)"))
pn_ps_mat2 <- readRDS("../03.results/20240409_Boston_pN_pS_mat_005.rds")
pn_ps_dis <- as.matrix(parDist(as.matrix(pn_ps_mat2), method = "euclidean"))
pn_ps_dis[is.na(pn_ps_dis)] <- 0
dmr <- cmdscale(pn_ps_dis, k = 4, eig = T)
eig <- dmr$eig
eig[eig < 0] <- 0
points <- as.data.frame(dmr$points[, 1:2])
eig1 <- 100 * eig[1] / sum(eig)
eig2 <- 100 * eig[2] / sum(eig)
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCoA of pN/pS in B. uniformis, Cosine distance') +
labs (x = paste0("PCo1 (", format(eig1, digits = 4), "%)"),
y = paste0("PCo2 (", format(eig2, digits = 4), "%)"))
pn_ps_mat2 <- readRDS("../03.results/20240409_Boston_pN_pS_mat_005.rds")
pn_ps_dis <- as.matrix(parDist(as.matrix(pn_ps_mat2), method = "cosine"))
pn_ps_dis[is.na(pn_ps_dis)] <- 0
dmr <- cmdscale(pn_ps_dis, k = 4, eig = T)
eig <- dmr$eig
eig[eig < 0] <- 0
points <- as.data.frame(dmr$points[, 1:2])
eig1 <- 100 * eig[1] / sum(eig)
eig2 <- 100 * eig[2] / sum(eig)
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCoA of pN/pS in B. uniformis, Cosine distance') +
labs (x = paste0("PCo1 (", format(eig1, digits = 4), "%)"),
y = paste0("PCo2 (", format(eig2, digits = 4), "%)"))
pn_ps_dis <- as.matrix(parDist(as.matrix(pn_ps_mat2), method = "cosine"))
pn_ps_dis[is.na(pn_ps_dis)] <- 0
dmr <- cmdscale(pn_ps_dis, k = 4, eig = T)
eig <- dmr$eig
eig[eig < 0] <- 0
points <- as.data.frame(dmr$points[, 1:2])
eig1 <- 100 * eig[1] / sum(eig)
eig2 <- 100 * eig[2] / sum(eig)
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCoA of pN/pS in B. uniformis, Cosine distance') +
labs (x = paste0("PCo1 (", format(eig1, digits = 4), "%)"),
y = paste0("PCo2 (", format(eig2, digits = 4), "%)"))
dn_ds_mat2 <- readRDS("../03.results/20240409_Boston_dN_dS_mat_005.rds")
dn_ds_dis <- as.matrix(parDist(as.matrix(dn_ds_mat2), method = "cosine"))
dn_ds_dis[is.na(dn_ds_dis)] <- 0
dmr <- cmdscale(dn_ds_dis, k = 4, eig = T)
eig <- dmr$eig
eig[eig < 0] <- 0
eig1 <- 100 * eig[1] / sum(eig)
eig2 <- 100 * eig[2] / sum(eig)
points <- as.data.frame(dmr$points[, 1:2])
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCoA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PCo1 (", format(eig1, digits = 4), "%)"),
y = paste0("PCo2 (", format(eig2, digits = 4), "%)"))
identical(dn_ds_dis, pn_ps_dis)
pn_ps_mat2 <- pn_ps_mat[, colSums(pn_ps_mat != 0) > n]
pn_ps_mat2 <- pn_ps_mat2[rowSums(pn_ps_mat2!=0) > n, ]
## save the matrix for GWAS (next Rmd), it is log10 transformed already
saveRDS(pn_ps_mat2, "../03.results/20240409_Boston_pN_pS_mat_005.rds")
pn_ps_mat2 <- readRDS("../03.results/20240409_Boston_pN_pS_mat_005.rds")
pn_ps_dis <- as.matrix(parDist(as.matrix(pn_ps_mat2), method = "cosine"))
identical(dn_ds_dis, pn_ps_dis)
pn_ps_mat2[1:3, 1:3]
dn_ds_mat2[1:3, 1:3]
pn_ps_mat[1:3, 1:3]
dn_ds_mat[1:3, 1:3]
################ For dN/dS plot ######################
pn_ps <- dat_plot[dat_plot$Evidence == "pN_pS",
colnames(dat_plot) %in% c("Sample_ID",
"Antibiotics",
"Gene_ID",
"Selection")]
pn_ps_mat <- as.data.frame(pn_ps %>% pivot_wider(names_from = "Gene_ID",
values_from = "Selection"))
des <- data.frame(Antibiotics = pn_ps_mat$Antibiotics)
rownames(des) <- pn_ps_mat$Sample_ID
des$Antibiotics <- as.character(des$Antibiotics)
rownames(pn_ps_mat) <- pn_ps_mat$Sample_ID
pn_ps_mat <- pn_ps_mat[, !(colnames(pn_ps_mat) %in%
c("Antibiotics", "Sample_ID"))]
pn_ps_mat <- log10(pn_ps_mat)
pn_ps_mat[is.na(pn_ps_mat)] <- 0
pn_ps_mat[1:3, 1:3]
head(dat_plot)
head(pn_ps)
head(dn_ds)
dn_ds
head(dn_ds)
################ For dN/dS plot ######################
dn_ds <- dat_plot[dat_plot$Evidence == "dN_dS",
colnames(dat_plot) %in% c("Sample_ID",
"Antibiotics",
"Gene_ID",
"Selection")]
head(dn_ds)
dn_ds_mat <- as.data.frame(dn_ds %>% pivot_wider(names_from = "Gene_ID",
values_from = "Selection"))
des <- data.frame(Antibiotics = dn_ds_mat$Antibiotics)
rownames(des) <- dn_ds_mat$Sample_ID
des$Antibiotics <- as.character(des$Antibiotics)
rownames(dn_ds_mat) <- dn_ds_mat$Sample_ID
dn_ds_mat <- dn_ds_mat[, !(colnames(dn_ds_mat) %in%
c("Antibiotics", "Sample_ID"))]
dn_ds_mat <- log10(dn_ds_mat)
dn_ds_mat[is.na(dn_ds_mat)] <- 0
dn_ds_mat[is.na(dn_ds_mat)] <- 0
pheatmap(dn_ds_mat, show_rownames = FALSE, show_colnames = FALSE,
annotation_row = des, annotation_colors = c_drug_lst)
################ For dN/dS plot ######################
pn_ps <- dat_plot[dat_plot$Evidence == "pN_pS",
colnames(dat_plot) %in% c("Sample_ID",
"Antibiotics",
"Gene_ID",
"Selection")]
pn_ps_mat <- as.data.frame(pn_ps %>% pivot_wider(names_from = "Gene_ID",
values_from = "Selection"))
des <- data.frame(Antibiotics = pn_ps_mat$Antibiotics)
rownames(des) <- pn_ps_mat$Sample_ID
des$Antibiotics <- as.character(des$Antibiotics)
rownames(pn_ps_mat) <- pn_ps_mat$Sample_ID
pn_ps_mat <- pn_ps_mat[, !(colnames(pn_ps_mat) %in%
c("Antibiotics", "Sample_ID"))]
pn_ps_mat <- log10(pn_ps_mat)
pn_ps_mat[is.na(pn_ps_mat)] <- 0
pheatmap(pn_ps_mat, show_rownames = FALSE, show_colnames = FALSE,
annotation_row = des, annotation_colors = c_drug_lst)
n <- round(nrow(dn_ds_mat) * 0.05)
dn_ds_mat2 <- dn_ds_mat[, colSums(dn_ds_mat != 0) > n]
dn_ds_mat2 <- dn_ds_mat2[rowSums(dn_ds_mat2!=0) > n, ]
## save the matrix for GWAS (next Rmd), it is log10 transformed already
saveRDS(dn_ds_mat2, "../03.results/20240409_Boston_dN_dS_mat_005.rds")
dn_ds_mat2 <- readRDS("../03.results/20240409_Boston_dN_dS_mat_005.rds")
dn_ds_dis <- as.matrix(parDist(as.matrix(dn_ds_mat2), method = "cosine"))
dn_ds_dis[is.na(dn_ds_dis)] <- 0
dmr <- cmdscale(dn_ds_dis, k = 4, eig = T)
eig <- dmr$eig
eig[eig < 0] <- 0
eig1 <- 100 * eig[1] / sum(eig)
eig2 <- 100 * eig[2] / sum(eig)
points <- as.data.frame(dmr$points[, 1:2])
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCoA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PCo1 (", format(eig1, digits = 4), "%)"),
y = paste0("PCo2 (", format(eig2, digits = 4), "%)"))
dn_ds_mat2 <- readRDS("../03.results/20240409_Boston_dN_dS_mat_005.rds")
dn_ds_dis <- as.matrix(parDist(as.matrix(dn_ds_mat2), method = "euclidean"))
dn_ds_dis[is.na(dn_ds_dis)] <- 0
dmr <- cmdscale(dn_ds_dis, k = 4, eig = T)
eig <- dmr$eig
eig[eig < 0] <- 0
eig1 <- 100 * eig[1] / sum(eig)
eig2 <- 100 * eig[2] / sum(eig)
points <- as.data.frame(dmr$points[, 1:2])
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCoA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PCo1 (", format(eig1, digits = 4), "%)"),
y = paste0("PCo2 (", format(eig2, digits = 4), "%)"))
dn_ds_mat2 <- readRDS("../03.results/20240409_Boston_dN_dS_mat_005.rds")
dn_ds_dis <- as.matrix(parDist(as.matrix(dn_ds_mat2), method = "cosine"))
dn_ds_dis[is.na(dn_ds_dis)] <- 0
dmr <- cmdscale(dn_ds_dis, k = 4, eig = T)
eig <- dmr$eig
eig[eig < 0] <- 0
eig1 <- 100 * eig[1] / sum(eig)
eig2 <- 100 * eig[2] / sum(eig)
points <- as.data.frame(dmr$points[, 1:2])
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCoA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PCo1 (", format(eig1, digits = 4), "%)"),
y = paste0("PCo2 (", format(eig2, digits = 4), "%)"))
dn_ds_mat2 <- readRDS("../03.results/20240409_Boston_dN_dS_mat_005.rds")
dn_ds_dis <- as.matrix(parDist(as.matrix(dn_ds_mat2), method = "cosine"))
dn_ds_dis[is.na(dn_ds_dis)] <- 0
dmr <- cmdscale(dn_ds_dis, k = 4, eig = T)
eig <- dmr$eig
eig[eig < 0] <- 0
eig1 <- 100 * eig[1] / sum(eig)
eig2 <- 100 * eig[2] / sum(eig)
points <- as.data.frame(dmr$points[, 1:2])
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCoA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PCo1 (", format(eig1, digits = 4), "%)"),
y = paste0("PCo2 (", format(eig2, digits = 4), "%)"))
dn_ds_mat2 <- readRDS("../03.results/20240409_Boston_dN_dS_mat_005.rds")
dn_ds_dis <- as.matrix(parDist(as.matrix(dn_ds_mat2), method = "cosine"))
dn_ds_dis[is.na(dn_ds_dis)] <- 0
dmr <- cmdscale(dn_ds_dis, k = 4, eig = T)
eig <- dmr$eig
eig[eig < 0] <- 0
eig1 <- 100 * eig[1] / sum(eig)
eig2 <- 100 * eig[2] / sum(eig)
points <- as.data.frame(dmr$points[, 1:2])
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCoA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PCo1 (", format(eig1, digits = 4), "%)"),
y = paste0("PCo2 (", format(eig2, digits = 4), "%)"))
dn_ds_mat2 <- readRDS("../03.results/20240409_Boston_dN_dS_mat_005.rds")
dn_ds_dis <- as.matrix(parDist(as.matrix(dn_ds_mat2), method = "cosine"))
dn_ds_dis[is.na(dn_ds_dis)] <- 0
dmr <- cmdscale(dn_ds_dis, k = 4, eig = T)
eig <- dmr$eig
eig[eig < 0] <- 0
eig1 <- 100 * eig[1] / sum(eig)
eig2 <- 100 * eig[2] / sum(eig)
points <- as.data.frame(dmr$points[, 1:2])
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCoA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PCo1 (", format(eig1, digits = 4), "%)"),
y = paste0("PCo2 (", format(eig2, digits = 4), "%)"))
points <- as.data.frame(dmr$points[, 3:4])
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCoA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PC3 (", format(eig3, digits = 4), "%)"),
y = paste0("PC4 (", format(eig4, digits = 4), "%)"))
dn_ds_mat2 <- readRDS("../03.results/20240409_Boston_dN_dS_mat_005.rds")
dn_ds_dis <- as.matrix(parDist(as.matrix(dn_ds_mat2), method = "cosine"))
dn_ds_dis[is.na(dn_ds_dis)] <- 0
dmr <- cmdscale(dn_ds_dis, k = 4, eig = T)
eig <- dmr$eig
eig[eig < 0] <- 0
eig1 <- 100 * eig[1] / sum(eig)
eig2 <- 100 * eig[2] / sum(eig)
eig3 <- 100 * eig[3] / sum(eig)
eig4 <- 100 * eig[4] / sum(eig)
points <- as.data.frame(dmr$points[, 1:2])
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
p1 <- ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PC1 (", format(eig1, digits = 4), "%)"),
y = paste0("PC2 (", format(eig2, digits = 4), "%)"))
points <- as.data.frame(dmr$points[, 3:4])
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
p2 <- ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PC3 (", format(eig3, digits = 4), "%)"),
y = paste0("PC4 (", format(eig4, digits = 4), "%)")) +
theme(legend.position = "none")
plot_grid(p1, p2, nrow = 1)
plot_grid(p1, p2, nrow = 1, rel_widths = c(1.2, 1))
plot_grid(p1, p2, nrow = 1, rel_widths = c(1.3, 1))
plot_grid(p1, p2, nrow = 1, rel_widths = c(1.4, 1))
plot_grid(p1, p2, nrow = 1, rel_widths = c(1.2, 1))
plot_grid(p1, p2, nrow = 1, rel_widths = c(1.4, 1))
pn_ps_mat2 <- pn_ps_mat[, colSums(pn_ps_mat != 0) > n]
pn_ps_mat2 <- pn_ps_mat2[rowSums(pn_ps_mat2!=0) > n, ]
## save the matrix for GWAS (next Rmd), it is log10 transformed already
saveRDS(pn_ps_mat2, "../03.results/20240409_Boston_pN_pS_mat_005.rds")
pn_ps_mat2 <- readRDS("../03.results/20240409_Boston_pN_pS_mat_005.rds")
pn_ps_dis <- as.matrix(parDist(as.matrix(pn_ps_mat2), method = "cosine"))
pn_ps_dis[is.na(pn_ps_dis)] <- 0
dmr <- cmdscale(pn_ps_dis, k = 4, eig = T)
eig <- dmr$eig
eig[eig < 0] <- 0
### for PC1/2
points <- as.data.frame(dmr$points[, 1:2])
eig1 <- 100 * eig[1] / sum(eig)
eig2 <- 100 * eig[2] / sum(eig)
eig3 <- 100 * eig[3] / sum(eig)
eig4 <- 100 * eig[4] / sum(eig)
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
p1 <- ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PC1 (", format(eig1, digits = 4), "%)"),
y = paste0("PC2 (", format(eig2, digits = 4), "%)"))
### for PC3/4
points <- as.data.frame(dmr$points[, 3:4])
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
p2 <- ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PC3 (", format(eig3, digits = 4), "%)"),
y = paste0("PC4 (", format(eig4, digits = 4), "%)")) +
theme(legend.position = "none")
plot_grid(p1, p2, nrow = 1, rel_widths = c(1.4, 1))
pn_ps_mat2 <- readRDS("../03.results/20240409_Boston_pN_pS_mat_005.rds")
pn_ps_dis <- as.matrix(parDist(as.matrix(pn_ps_mat2), method = "cosine"))
pn_ps_dis[is.na(pn_ps_dis)] <- 0
dmr <- cmdscale(pn_ps_dis, k = 4, eig = T)
eig <- dmr$eig
eig[eig < 0] <- 0
### for PC1/2
points <- as.data.frame(dmr$points[, 1:2])
eig1 <- 100 * eig[1] / sum(eig)
eig2 <- 100 * eig[2] / sum(eig)
eig3 <- 100 * eig[3] / sum(eig)
eig4 <- 100 * eig[4] / sum(eig)
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
p1 <- ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PC1 (", format(eig1, digits = 4), "%)"),
y = paste0("PC2 (", format(eig2, digits = 4), "%)"))
### for PC3/4
points <- as.data.frame(dmr$points[, 3:4])
meta2 <- meta2[match(rownames(points), meta2$Sample_ID), ]
points <- cbind(points, meta2)
colnames(points)[1:2] <- c("x", "y")
p2 <- ggplot(points, aes(x, y, color = Antibiotics)) +
geom_point(aes(shape = Cohort), size = 2.4) + main_theme +
scale_color_manual(values = c_drug) +
scale_shape_manual(values = c(1, 2)) +
ggtitle('PCA of dN/dS in B. uniformis, Cosine distance') +
labs (x = paste0("PC3 (", format(eig3, digits = 4), "%)"),
y = paste0("PC4 (", format(eig4, digits = 4), "%)")) +
theme(legend.position = "none")
plot_grid(p1, p2, nrow = 1, rel_widths = c(1.4, 1))
View(p1)
