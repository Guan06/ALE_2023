getwd()
source("settings.R")
###############################################################################
# read in all variants detected in ALE 1.0 and ALE 2.0 with AF > 0.05
all <- readRDS("../04.results/20231023_all_005.rds")
t1 <- all %>% group_by(POS) %>% summarise(Prevalence =
length(unique(Sample_ID)),
Average_AF = mean(Ratio))
t1_des <- unique(all[, c("POS", "FTYPE", "Effect")])
t1 <- merge(t1, t1_des)
map <- read.table("../00.data/vcf_20231024_effect_map.txt",
header = T, sep = "\t")
map$Effect_type <- as.factor(map$Effect_type)
t1 <- merge(t1, map)
###############################################################################
# read in all variants detected in ALE 1.0 and ALE 2.0 with AF > 0.5
all_05 <- readRDS("../04.results/20231023_all_05.rds")
t1 <- all_05 %>% group_by(POS) %>% summarise(Prevalence =
length(unique(Sample_ID)),
Average_AF = mean(Ratio))
t1_des <- unique(all_05[, c("POS", "FTYPE", "Effect")])
t1 <- merge(t1, t1_des)
t1 <- merge(t1, map)
gff <-read.delim("../00.data/annot_RAST_simp.gff", header = F, sep = "\t")
colnames(gff) <- c("Start", "End", "Strand", "Gene_ID", "Annotation")
region <- all[(all$POS > 1910551) & (all$POS < 1944637), ]
region <- merge(region, map)
gene_lst <- paste0("peg.", seq(1535, 1563))
region_gff <- gff[gff$Gene_ID %in% gene_lst, ]
## Get the coordinate of this gene
this_start <- min(region_gff$Start)
this_end <- max(region_gff$End)
colnames(region_gff) <- c("start", "end", "strand", "gene", "protein")
region_gff$orientation <- ifelse(region_gff$strand == "+", 1, 0)
region_gff$molecule <- ""
View(region_gff)
start
###############################################################################
#### Panel D - RND efflux pump
pos_gene <- read.table("../00.data/vcf_20231025_position_gene_map.txt",
header = F, sep = "\t")
colnames(pos_gene) <- c("POS", "Type", "Gene")
all <- merge(all, pos_gene)
this_gene_ID <- c("peg.961", "peg.962", "peg.963")
this_gene <- all[all$Gene %in% this_gene_ID, ]
this_gene <- merge(this_gene, map)
this_gff <- gff[gff$Gene_ID %in% this_gene_ID, ]
## Get the coordinate of this gene
this_start <- min(gff[gff$Gene_ID %in% this_gene_ID, ]$Start)
this_end <- max(gff[gff$Gene_ID %in% this_gene_ID, ]$End)
View(this_gene)
colanmes(this_gene)
colnames(this_gene)
t <- this_gene[, colnames(this_gene) %in% c("POS", "Sample_ID", "AA_POS", "EFFECT", "Compound", "Ratio")]
t
View(t)
###############################################################################
#### Panel E - AcrR
this_gene_ID <- c( "peg.1416", "peg.1417")
this_gene <- all[all$Gene %in% this_gene_ID, ]
this_gene <- merge(this_gene, map)
## Get the coordinate of this gene
this_gff <- gff[gff$Gene_ID %in% this_gene$Gene, ]
this_start <- min(this_gff$End)
this_end <- max(this_gff$End)
t <- this_gene[, colnames(this_gene) %in% c("POS", "Sample_ID", "AA_POS", "EFFECT", "Compound", "Ratio")]
t
source("~/Library/CloudStorage/OneDrive-UniversityofCambridge/Desktop/ALE_2023/02.scripts_variants/Figure_S4.R")
install.packages("ggplot2")
source("~/Library/CloudStorage/OneDrive-UniversityofCambridge/Desktop/ALE_2023/02.scripts_variants/Figure_S4.R")
### Make sure to run/source pre_Figure_S4.R before this scripts
### AF > 0.05
tab1 <- read.table("../04.results/Figure_S4_variant_number_AF_005.txt",
header = T, sep = "\t")
avg_nt1 <- mean(tab1[tab1$Compound == "NT5002", ]$Number_of_variants)
print(paste("Average number of variant (AF > 0.05) of parental strain: ",
avg_nt1))
tab1$Group <- "AF > 0.05"
### AF > 0.5
tab2 <- read.table("../04.results/Figure_S4_variant_number_AF_05.txt",
header = T, sep = "\t")
avg_nt2 <- mean(tab2[tab2$Compound == "NT5002", ]$Number_of_variants)
print(paste("Average number of variant (AF > 0.5) of parental strain: ",
avg_nt2))
tab2$Group <- "AF > 0.5"
tab <- rbind(tab1, tab2)
tab$Concentration <- as.character(tab$Concentration)
tab$Plate <- as.character(tab$Plate)
df_avg <- data.frame(Group = unique((tab$Group)),
Avg = c(avg_nt1, avg_nt2))
p_s5a <- ggplot(tab, aes(Compound,
Number_of_variants)) +
geom_boxplot(color = "gray47", outlier.shape = NA) +
geom_point(aes(color = Concentration),
alpha = 0.8,
position = "jitter") +
facet_grid(rows = vars(Group), cols = vars(Plate),
scales = "free", space = "free_x") +
scale_color_manual(values = c("0" = "gray",
"25" = "#a0cbe8",
"250" = "navyblue",
"50" = "#1170aa",
"500" = "navyblue"))  +
scale_shape_manual(values = c(1, 2, 3, 5, 4)) +
geom_abline(data = df_avg, aes(intercept = Avg, slope = 0),
linetype = "longdash", color = "salmon") +
main_theme +
labs(x = "", y = "Number of variants") +
theme(legend.position = "top",
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
source("settings.R")
p_s5a <- ggplot(tab, aes(Compound,
Number_of_variants)) +
geom_boxplot(color = "gray47", outlier.shape = NA) +
geom_point(aes(color = Concentration),
alpha = 0.8,
position = "jitter") +
facet_grid(rows = vars(Group), cols = vars(Plate),
scales = "free", space = "free_x") +
scale_color_manual(values = c("0" = "gray",
"25" = "#a0cbe8",
"250" = "navyblue",
"50" = "#1170aa",
"500" = "navyblue"))  +
scale_shape_manual(values = c(1, 2, 3, 5, 4)) +
geom_abline(data = df_avg, aes(intercept = Avg, slope = 0),
linetype = "longdash", color = "salmon") +
main_theme +
labs(x = "", y = "Number of variants") +
theme(legend.position = "top",
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
source("~/Library/CloudStorage/OneDrive-UniversityofCambridge/Desktop/ALE_2023/02.scripts_variants/Figure_S4.R")
View(tab1)
t <- tab1[tab1$Compound == "NT5002", ]
View(t)
###############################################################################
# read in all variants detected in ALE 1.0 and ALE 2.0 with AF > 0.05
all <- readRDS("../04.results/20231023_all_005.rds")
t1 <- all %>% group_by(POS) %>% summarise(Prevalence =
length(unique(Sample_ID)),
Average_AF = mean(Ratio))
t1_des <- unique(all[, c("POS", "FTYPE", "Effect")])
t1 <- merge(t1, t1_des)
map <- read.table("../00.data/vcf_20231024_effect_map.txt",
header = T, sep = "\t")
map$Effect_type <- as.factor(map$Effect_type)
t1 <- merge(t1, map)
head(t1)
gff <-read.delim("../00.data/annot_RAST_simp.gff", header = F, sep = "\t")
colnames(gff) <- c("Start", "End", "Strand", "Gene_ID", "Annotation")
region <- all[(all$POS > 1910551) & (all$POS < 1944637), ]
region <- merge(region, map)
gene_lst <- paste0("peg.", seq(1535, 1563))
region_gff <- gff[gff$Gene_ID %in% gene_lst, ]
## Get the coordinate of this gene
this_start <- min(region_gff$Start)
this_end <- max(region_gff$End)
colnames(region_gff) <- c("start", "end", "strand", "gene", "protein")
region_gff$orientation <- ifelse(region_gff$strand == "+", 1, 0)
region_gff$molecule <- ""
head(region_gff)
View(region_gff)
View(region)
t <- region[region$Sample_ID %in% c("Plate1B9", "Plate1C9"), ]
View(t)
unique(t$POS)
lst <- unique(t$POS)
region2 <- region[!(region$POS %in% lst), ]
dim(region)
dim(region2)
ggplot(region2, aes(POS, Ratio)) +
geom_point(aes(color = Concentration, shape = Effect_type),
size = 3, alpha = 0.8) +
xlim(this_start, this_end) +
scale_shape_manual(limits = map$Effect_type,
values = map$Shape, guide = F) +
scale_color_manual(values = c("0" = "gray",
"25" = "#a0cbe8",
"250" = "navyblue",
"50" = "#1170aa",
"500" = "navyblue")) +
#scale_size(range = c(0.25, 5), guide = F) +
labs(x = "", y = "Allele Frequence (AF)") +
theme_bw() +
theme(legend.position = "top",
legend.justification = c("left", "center")) +
#guides(shape = guide_legend(nrow = 1)) +
theme(legend.background = element_blank())
#### Panel C, variants between 1912 - 1945 Kb
### get region from peg.1535 to peg.1563
library(gggenes)
gff <-read.delim("../00.data/annot_RAST_simp.gff", header = F, sep = "\t")
colnames(gff) <- c("Start", "End", "Strand", "Gene_ID", "Annotation")
region <- all[(all$POS > 1910551) & (all$POS < 1944637), ]
# read in all variants detected in ALE 1.0 and ALE 2.0 with AF > 0.05
all <- readRDS("../04.results/20231023_all_005.rds")
region <- all[(all$POS > 1910551) & (all$POS < 1944637), ]
region <- merge(region, map)
gene_lst <- paste0("peg.", seq(1535, 1563))
region_gff <- gff[gff$Gene_ID %in% gene_lst, ]
## Get the coordinate of this gene
this_start <- min(region_gff$Start)
this_end <- max(region_gff$End)
colnames(region_gff) <- c("start", "end", "strand", "gene", "protein")
region_gff$orientation <- ifelse(region_gff$strand == "+", 1, 0)
region_gff$molecule <- ""
p_c1 <- ggplot(region_gff, aes(xmin = start, xmax = end,
y = molecule, fill = protein,
forward = orientation)) +
geom_gene_arrow() + labs(y = "") +
xlim(this_start, this_end) +
scale_fill_brewer(palette = "Set3") +
theme_genes() +
theme(legend.position = "none")
p_c1
unique(region$Sample_ID)
## Get the list of position where variants were detected in parental strains
lst <- region[region$Sample_ID %in% c("Plate1B9", "Plate1C9"), ]
## Get the list of position where variants were detected in parental strains
region_parental <- region[region$Sample_ID %in% c("Plate1B9", "Plate1C9"), ]
View(region_parental)
region_parental <- region_parental[region_parental$Ratio > 0.1, ]
lst <- unique(region_parental$Sample_ID)
lst
lst <- unique(region_parental$POS)
lst
region_filter <- region[!(region$POS %in% lst), ]
##AF of each variants from each compounds
p_c2 <- ggplot(region, aes(POS, Ratio)) +
geom_point(aes(color = Concentration, shape = Effect_type),
size = 3, alpha = 0.8) +
xlim(this_start, this_end) +
scale_shape_manual(limits = map$Effect_type,
values = map$Shape, guide = F) +
scale_color_manual(values = c("0" = "gray",
"25" = "#a0cbe8",
"250" = "navyblue",
"50" = "#1170aa",
"500" = "navyblue")) +
#scale_size(range = c(0.25, 5), guide = F) +
labs(x = "", y = "Allele Frequence (AF)") +
theme_bw() +
theme(legend.position = "top",
legend.justification = c("left", "center")) +
#guides(shape = guide_legend(nrow = 1)) +
theme(legend.background = element_blank())
map <- read.table("../00.data/vcf_20231024_effect_map.txt",
header = T, sep = "\t")
map$Effect_type <- as.factor(map$Effect_type)
##AF of each variants from each compounds
p_c2 <- ggplot(region, aes(POS, Ratio)) +
geom_point(aes(color = Concentration, shape = Effect_type),
size = 3, alpha = 0.8) +
xlim(this_start, this_end) +
scale_shape_manual(limits = map$Effect_type,
values = map$Shape, guide = F) +
scale_color_manual(values = c("0" = "gray",
"25" = "#a0cbe8",
"250" = "navyblue",
"50" = "#1170aa",
"500" = "navyblue")) +
#scale_size(range = c(0.25, 5), guide = F) +
labs(x = "", y = "Allele Frequence (AF)") +
theme_bw() +
theme(legend.position = "top",
legend.justification = c("left", "center")) +
#guides(shape = guide_legend(nrow = 1)) +
theme(legend.background = element_blank())
p_c <- plot_grid(p_c2, p_c1, nrow = 2, rel_heights = c(4, 1),
align = "v", axis = "l")
##AF of each variants from each compounds
p_c2 <- ggplot(region_filter, aes(POS, Ratio)) +
geom_point(aes(color = Concentration, shape = Effect_type),
size = 3, alpha = 0.8) +
xlim(this_start, this_end) +
scale_shape_manual(limits = map$Effect_type,
values = map$Shape, guide = F) +
scale_color_manual(values = c("0" = "gray",
"25" = "#a0cbe8",
"250" = "navyblue",
"50" = "#1170aa",
"500" = "navyblue")) +
#scale_size(range = c(0.25, 5), guide = F) +
labs(x = "", y = "Allele Frequence (AF)") +
theme_bw() +
theme(legend.position = "top",
legend.justification = c("left", "center")) +
#guides(shape = guide_legend(nrow = 1)) +
theme(legend.background = element_blank())
p_c <- plot_grid(p_c2, p_c1, nrow = 2, rel_heights = c(4, 1),
align = "v", axis = "l")
map <- read.table("../00.data/vcf_20231024_effect_map.txt",
header = T, sep = "\t")
map$Effect_type <- as.factor(map$Effect_type)
region <- all[(all$POS > 1910551) & (all$POS < 1944637), ]
region <- merge(region, map)
gff <-read.delim("../00.data/annot_RAST_simp.gff", header = F, sep = "\t")
colnames(gff) <- c("Start", "End", "Strand", "Gene_ID", "Annotation")
# read in all variants detected in ALE 1.0 and ALE 2.0 with AF > 0.05
all <- readRDS("../04.results/20231023_all_005.rds")
map <- read.table("../00.data/vcf_20231024_effect_map.txt",
header = T, sep = "\t")
map$Effect_type <- as.factor(map$Effect_type)
region <- all[(all$POS > 1910551) & (all$POS < 1944637), ]
region <- merge(region, map)
gene_lst <- paste0("peg.", seq(1535, 1563))
region_gff <- gff[gff$Gene_ID %in% gene_lst, ]
## Get the coordinate of this gene
this_start <- min(region_gff$Start)
this_end <- max(region_gff$End)
colnames(region_gff) <- c("start", "end", "strand", "gene", "protein")
region_gff$orientation <- ifelse(region_gff$strand == "+", 1, 0)
region_gff$molecule <- ""
## Get the list of position where variants were detected in parental strains
region_parental <- region[region$Sample_ID %in% c("Plate1B9", "Plate1C9"), ]
region_parental <- region_parental[region_parental$Ratio > 0.1, ]
lst <- unique(region_parental$POS)
region_filter <- region[!(region$POS %in% lst), ]
##AF of each variants from each compounds
p_c2 <- ggplot(region_filter, aes(POS, Ratio)) +
geom_point(aes(color = Concentration, shape = Effect_type),
size = 3, alpha = 0.8) +
xlim(this_start, this_end) +
scale_shape_manual(limits = map$Effect_type,
values = map$Shape, guide = F) +
scale_color_manual(values = c("0" = "gray",
"25" = "#a0cbe8",
"250" = "navyblue",
"50" = "#1170aa",
"500" = "navyblue")) +
#scale_size(range = c(0.25, 5), guide = F) +
labs(x = "", y = "Allele Frequence (AF)") +
theme_bw() +
theme(legend.position = "top",
legend.justification = c("left", "center")) +
#guides(shape = guide_legend(nrow = 1)) +
theme(legend.background = element_blank())
p_c <- plot_grid(p_c2, p_c1, nrow = 2, rel_heights = c(4, 1),
align = "v", axis = "l")
p_c
region <- region[!(region$Sample_ID %in% c("Plate1B9",
"Plate1C9")), ]
##AF of each variants from each compounds
p_c2 <- ggplot(region, aes(POS, Ratio)) +
geom_point(aes(color = Concentration, shape = Effect_type),
size = 3, alpha = 0.8) +
xlim(this_start, this_end) +
scale_shape_manual(limits = map$Effect_type,
values = map$Shape, guide = F) +
scale_color_manual(values = c("0" = "gray",
"25" = "#a0cbe8",
"250" = "navyblue",
"50" = "#1170aa",
"500" = "navyblue")) +
#scale_size(range = c(0.25, 5), guide = F) +
labs(x = "", y = "Allele Frequence (AF)") +
theme_bw() +
theme(legend.position = "top",
legend.justification = c("left", "center")) +
#guides(shape = guide_legend(nrow = 1)) +
theme(legend.background = element_blank())
p_c2
debugSource("~/Library/CloudStorage/OneDrive-UniversityofCambridge/Desktop/ALE_2023/02.scripts_variants/Figure_2c_filter.R")
## Get the list of position where variants were detected in parental strains
region_parental <- region[region$Sample_ID %in% c("Plate1B9", "Plate1C9"), ]
## Get the list of position where variants were detected in parental strains
region_parental <- region[region$Sample_ID %in% c("Plate1B9", "Plate1C9"), ]
p_c1 <- ggplot(region_gff, aes(xmin = start, xmax = end,
y = molecule, fill = protein,
forward = orientation)) +
geom_gene_arrow() + labs(y = "") +
xlim(this_start, this_end) +
scale_fill_brewer(palette = "Set3") +
theme_genes() +
theme(legend.position = "none")
source("~/Library/CloudStorage/OneDrive-UniversityofCambridge/Desktop/ALE_2023/02.scripts_variants/Figure_2c_filter.R")
ggsave("../05.figures/Figure_2c_filter.pdf", p_c, width = 10, height = 3)
source("~/Library/CloudStorage/OneDrive-UniversityofCambridge/Desktop/ALE_2023/02.scripts_variants/Figure_2c_filter.R")
